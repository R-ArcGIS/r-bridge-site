{
  "hash": "9bd724d808c6947acc865fc833d610ae",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Publishing from R\"\nsubtitle: \"Create Hosted ArcGIS Online or Enterprise Feature Services from R\"\n---\n\n\nIn addition to consuming data as an R user, you may also want to publish data as a hosted feature service. In this tutorial, you will learn how to publish an `sf` object <!-- or a `data.frame`--> to ArcGIS Online or Enterprise. \n\n## Authorization\n\nIn order to publish content to ArcGIS Online or Enterprise, you must first obtain an access token permitting you to do so. \n\n:::{.callout-caution}\nIf you have not yet set up your R environment for authorization, see [**Authorize with your Portal**](..//auth/connecting-to-a-portal.qmd). Ensure that the environment variables `ARCGIS_CLIENT` and `ARCGIS_USER` are set at minimum. If you are using ArcGIS Enterprise, ensure that `ARCGIS_HOST` is properly set as well.\n:::\n\nGo through the following code flow to set your credentials.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arcgis)\n\ntoken <- auth_code()  # <1>\nset_arc_token(token) # <2>\n```\n:::\n\n1. Create an access token\n2. Set it to an environment variable.\n\nNow that you have authorized to your Portal, you will be able to publish content. \n\n## Publishing {sf} objects\n\nTo publish an `{sf}` object to your portal, you can use the function `publish_layer()`. The publishing process requires you to add an item to your portal and publish it. The `publish_layer()` function handles these steps for you. \n\nFirst, read in the [North Carolina SIDS](https://cran.r-project.org/web/packages/spdep/vignettes/sids.html) dataset that comes packaged with `sf` and store it in an object called `nc`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc <- sf::read_sf(system.file(\"shape/nc.shp\", package = \"sf\"))\nnc\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 100 features and 14 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965\nGeodetic CRS:  NAD27\n# A tibble: 100 × 15\n    AREA PERIMETER CNTY_ CNTY_ID NAME  FIPS  FIPSNO CRESS_ID BIR74 SID74 NWBIR74\n   <dbl>     <dbl> <dbl>   <dbl> <chr> <chr>  <dbl>    <int> <dbl> <dbl>   <dbl>\n 1 0.114      1.44  1825    1825 Ashe  37009  37009        5  1091     1      10\n 2 0.061      1.23  1827    1827 Alle… 37005  37005        3   487     0      10\n 3 0.143      1.63  1828    1828 Surry 37171  37171       86  3188     5     208\n 4 0.07       2.97  1831    1831 Curr… 37053  37053       27   508     1     123\n 5 0.153      2.21  1832    1832 Nort… 37131  37131       66  1421     9    1066\n 6 0.097      1.67  1833    1833 Hert… 37091  37091       46  1452     7     954\n 7 0.062      1.55  1834    1834 Camd… 37029  37029       15   286     0     115\n 8 0.091      1.28  1835    1835 Gates 37073  37073       37   420     0     254\n 9 0.118      1.42  1836    1836 Warr… 37185  37185       93   968     4     748\n10 0.124      1.43  1837    1837 Stok… 37169  37169       85  1612     1     160\n# ℹ 90 more rows\n# ℹ 4 more variables: BIR79 <dbl>, SID79 <dbl>, NWBIR79 <dbl>,\n#   geometry <MULTIPOLYGON [°]>\n```\n\n\n:::\n:::\n\n\nNow that you have an `sf` object and you have authorized with your portal, all that's left is to publish the item! \n\n`publish_layer()` has only two required arguments: \n\n- `x` the `sf` object or `data.frame`\n- `title` the title of layer you are creating\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- publish_layer(nc, \"North Carolina SIDS\")\nres\n#> $services\n#>              type\n#> 1 Feature Service\n#>                                                                                             serviceurl\n#> 1 https://services1.arcgis.com/hLJbHVT9ZrDIzK0I/arcgis/rest/services/North Carolina SIDS/FeatureServer\n#>     size                                jobId                    serviceItemId\n#> 1 125766 f14451a7-325b-40b0-85c3-534bcf122806 32511ce0413f40d08303e267a7093be0\n#>                                                                                          encodedServiceURL\n#> 1 https://services1.arcgis.com/hLJbHVT9ZrDIzK0I/arcgis/rest/services/North%20Carolina%20SIDS/FeatureServer\n```\n:::\n\n\n:::{.callout-warning}\nIf you encounter errors while publishing, try using a feature layer title that does not contain spaces or special characters, such as \"NorthCarolinaSIDS\" for this example.\n:::\n\nNow from your Portal's [Content page](https://arcgis.com/home/content.html) you should see two items associated with your feature service:\n\n![](../shared/images/publish/published-items.png){width=70%}\n\nBehind the scenes, `publish_layer()` added the `sf` object as a *Feature Layer* item first and then published this item as a *Feature Layer (hosted)*. After publishing, you will typically only interact with the hosted feature layer. (Note that the dependency between these two items prevents you from deleting the underlying feature layer while the hosted feature layer still exists.)\n\nClick **View details** on the hosted feature layer item and you should see something like the below:\n\n![](../shared/images/publish/nc-sids.png){width=70%}\n\n## Reading the published Feature Layer\n\nThe output of the `publish_layer()` function is a list that contains information about where the `sf` object was published.\nYou can retrieve the `encodedServiceUrl` from the response and use `arc_open()` to return the metadata for your newly-created service. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc_fserver <- arc_open(res[[c(\"services\", \"encodedServiceURL\")]])\nnc_fserver\n#> <FeatureServer <1 layer, 0 tables>>\n#> CRS: 4267\n#> Capabilities: Create,Delete,Query,Update,Editing\n#>   0: North Carolina SIDS (esriGeometryPolygon)\n```\n:::\n\n\nYou'll notice that this is a `FeatureServer`. All items that are published to a Portal become their own Feature Server with a single `FeatureLayer`.\n\nYou can extract a single layer from the `FeatureServer` using `get_layer()`. Provide the `FeatureServer` as the first argument and then the ID of the layer you want as the second argument. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_layer(nc_fserver, 0)\n#> <FeatureLayer>\n#> Name: North Carolina SIDS\n#> Geometry Type: esriGeometryPolygon\n#> CRS: 4267\n#> Capabilities: Create,Delete,Query,Update,Editing\n```\n:::\n\n\n\n\n## Publishing `data.frame`s \n\nPublishing a `data.frame` follows the same steps as those above. The difference is that it creates a `Table` object. Try repeating the same process but using the palmerpenguins dataset! \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"palmerpenguins\")\npalmerpenguins::penguins\n```\n:::\n\n\n:::{.callout-tip title=\"Solution\" collapse=\"true\"}\n\n::: {.cell}\n\n```{.r .cell-code}\npublish_layer(palmerpenguins::penguins, \"Palmer Penguins\")\n```\n:::\n\n\n:::\n",
    "supporting": [
      "publishing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}